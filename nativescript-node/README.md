Using an inlined and slightly modified version for now - still deciding what to do with fs..
but I think this needs to be extended and externalized one day.